# 硬盘挂载

1. `fdisk -l` 查看未挂载硬盘，看到`/dev/vdb` 未挂载
    
    ```bash
    Disk /dev/vda: 100 GiB, 107374182400 bytes, 209715200 sectors
    Units: sectors of 1 * 512 = 512 bytes
    Sector size (logical/physical): 512 bytes / 512 bytes
    I/O size (minimum/optimal): 512 bytes / 512 bytes
    Disklabel type: dos
    Disk identifier: 0x09ce5309
    
    Device     Boot Start       End   Sectors  Size Id Type
    /dev/vda1  *     2048 209715166 209713119  100G 83 Linux
    
    Disk /dev/vdb: 1000 GiB, 1073741824000 bytes, 2097152000 sectors
    Units: sectors of 1 * 512 = 512 bytes
    Sector size (logical/physical): 512 bytes / 512 bytes
    I/O size (minimum/optimal): 512 bytes / 512 bytes
    ```
    
2. 使用`fdisk /dev/vdb` 创建分区
    1. n表示new
    2. p表示主分区
    3. 1是分区号
    4. 指定开始扇区，回车使用默认，即扇区开始位置
    5. 指定结束分区，同样回车使用默认，即扇区结束位置
    6. w保存
    
    ```bash
    Welcome to fdisk (util-linux 2.34).
    Changes will remain in memory only, until you decide to write them.
    Be careful before using the write command.
    
    Device does not contain a recognized partition table.
    Created a new DOS disklabel with disk identifier 0x242fd435.
    
    Command (m for help): n
    Partition type
       p   primary (0 primary, 0 extended, 4 free)
       e   extended (container for logical partitions)
    Select (default p): 
    
    Using default response p.
    Partition number (1-4, default 1): 
    First sector (2048-2097151999, default 2048): 
    Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-2097151999, default 2097151999): 
    
    Created a new partition 1 of type 'Linux' and of size 1000 GiB.
    
    Command (m for help): w
    The partition table has been altered.
    Calling ioctl() to re-read partition table.
    Syncing disks.
    ```
    
3. 格式化分区，指定格式为ext4，命令 `mkfs -t ext4 /dev/vdb1`
    
    ```bash
    mke2fs 1.45.5 (07-Jan-2020)
    Creating filesystem with 262143744 4k blocks and 65536000 inodes
    Filesystem UUID: 02f94ba0-b539-420e-aac7-5b5c3e298910
    Superblock backups stored on blocks: 
            32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
            4096000, 7962624, 11239424, 20480000, 23887872, 71663616, 78675968, 
            102400000, 214990848
    
    Allocating group tables: done                            
    Writing inode tables: done                            
    Creating journal (262144 blocks): done
    Writing superblocks and filesystem accounting information: done
    ```
    
4. 创建挂载点，在根目录下创建data目录`mkdir data`
5. 进行挂载`mount /dev/vdb1 /data`
6. 使用`df -h`查看硬盘使用状况
    
    ```bash
    Filesystem      Size  Used Avail Use% Mounted on
    udev             12G     0   12G   0% /dev
    tmpfs           2.3G  736K  2.3G   1% /run
    /dev/vda1        99G   13G   82G  14% /
    tmpfs            12G     0   12G   0% /dev/shm
    tmpfs           5.0M     0  5.0M   0% /run/lock
    tmpfs            12G     0   12G   0% /sys/fs/cgroup
    tmpfs           2.3G     0  2.3G   0% /run/user/1000
    /dev/vdb1       984G   28K  934G   1% /data
    ```
    
7. 查看硬盘UUID`blkid /dev/vdb1`
    
    ```bash
    /dev/vdb1: UUID="02f94ba0-b539-420e-aac7-5b5c3e298910" TYPE="ext4" PARTUUID="242fd435-01"
    ```
    
8. 将分区挂载写入fstab文件，防止主机重启后分区丢失的问题`vim /etc/fstab`
    
    ```bash
    UUID=02f94ba0-b539-420e-aac7-5b5c3e298910 /data           ext4    defaults 0       0
    ```
    

### fstab参数：

1. 第一列 Device 可以使用label和uuid，一般使用该设备uuid，因为一旦磁盘插槽顺序发生变化，label可能会改变，uuid是不会变化的，命令 `blkid /dev/vdb1` 可以查看uuid
2. 第二列 Mount point 挂载点，表示要挂载到哪个目录，比如上面我使用的是 /data
3. 第三列 fileSystem 磁盘文件系统格式，包括ext2，ext3，nfs，vfat等
4. 第四列 parameters 文件系统参数
    
    | 选项        | 说明                                                          |
    | ----------- | ------------------------------------------------------------- |
    | Async/sync  | 设置是否为同步方式运行，默认为async                           |
    | auto/noauto | 当下载mount -a 的命令时，此文件系统是否被主动挂载。默认为auto |
    | rw/ro       | 是否以以只读或者读写模式挂载                                  |
    | exec/noexec | 限制此文件系统内是否能够进行"执行"的操作                      |
    | user/nouser | 是否允许用户使用mount命令挂载                                 |
    | suid/nosuid | 是否允许SUID的存在                                            |
    | Usrquota    | 启动文件系统支持磁盘配额模式                                  |
    | Grpquota    | 启动文件系统对群组磁盘配额模式的支持                          |
    | Defaults    | 同时具有rw,suid,dev,exec,auto,nouser,async等默认参数的设置    |
5. 第五列 能否被dump备份命令作用
    
    | 选项 | 说明             |
    | ---- | ---------------- |
    | 0    | 不要做dump备份   |
    | 1    | 每天进行dump操作 |
    | 2    | 不定日期的进行   |
6. 是否检验扇区，开机过程中，系统默认以fsck检验系统是否完整
    
    | 选项 | 说明                         |
    | ---- | ---------------------------- |
    | 0    | 不要检验                     |
    | 1    | 最早检验（一般根目录会选择） |
    | 2    | 1级别检验完成之后进行检验    |
    